<?php

namespace App\Rules;

use Closure;
use Illuminate\Contracts\Validation\ValidationRule;

class PhoneNumberRule implements ValidationRule
{
    protected $countryCode;

    public function __construct($countryCode)
    {
        // Eliminar cualquier signo de más al principio del código de país
        $this->countryCode = ltrim($countryCode, '+');
    }

    /**
     * Run the validation rule.
     *
     * @param  string  $attribute
     * @param  mixed  $value
     * @param  Closure(string): \Illuminate\Translation\PotentiallyTranslatedString  $fail
     */
    public function validate(string $attribute, mixed $value, Closure $fail): void
    {
        $patterns = [
            '93'    => '/^[1-9][0-9]{8}$/', // Afghanistan
            '355'   => '/^[1-9][0-9]{8}$/', // Albania
            '213'   => '/^[1-9][0-9]{8}$/', // Algeria
            '1684'  => '/^[1-9][0-9]{6,7}$/', // American Samoa
            '376'   => '/^[3-6][0-9]{5}$/', // Andorra
            '244'   => '/^[1-9][0-9]{8}$/', // Angola
            '1264'  => '/^[1-9][0-9]{6,7}$/', // Anguilla
            '1268'  => '/^[1-9][0-9]{6,7}$/', // Antigua and Barbuda
            '54'    => '/^[1-9][0-9]{8,9}$/', // Argentina
            '374'   => '/^[1-9][0-9]{8}$/', // Armenia
            '297'   => '/^[1-9][0-9]{6,7}$/', // Aruba
            '61'    => '/^[4-5][0-9]{8}$/', // Australia
            '43'    => '/^[1-9][0-9]{9}$/', // Austria
            '994'   => '/^[1-9][0-9]{8}$/', // Azerbaijan
            '1242'  => '/^[1-9][0-9]{6,7}$/', // Bahamas
            '973'   => '/^[1-9][0-9]{7}$/', // Bahrain
            '880'   => '/^[1-9][0-9]{8}$/', // Bangladesh
            '1246'  => '/^[1-9][0-9]{6,7}$/', // Barbados
            '375'   => '/^[1-9][0-9]{8}$/', // Belarus
            '32'    => '/^[1-9][0-9]{8}$/', // Belgium
            '501'   => '/^[1-9][0-9]{6,7}$/', // Belize
            '229'   => '/^[1-9][0-9]{8}$/', // Benin
            '1441'  => '/^[1-9][0-9]{6,7}$/', // Bermuda
            '975'   => '/^[1-9][0-9]{7}$/', // Bhutan
            '591'   => '/^[1-9][0-9]{8}$/', // Bolivia
            '387'   => '/^[1-9][0-9]{8}$/', // Bosnia and Herzegovina
            '267'   => '/^[1-9][0-9]{8}$/', // Botswana
            '55'    => '/^[1-9][0-9]{9,10}$/', // Brazil
            '673'   => '/^[1-9][0-9]{6,7}$/', // Brunei
            '359'   => '/^[1-9][0-9]{8}$/', // Bulgaria
            '226'   => '/^[1-9][0-9]{8}$/', // Burkina Faso
            '257'   => '/^[1-9][0-9]{8}$/', // Burundi
            '855'   => '/^[1-9][0-9]{8}$/', // Cambodia
            '237'   => '/^[1-9][0-9]{8}$/', // Cameroon
            '1'     => '/^[2-9][0-9]{9}$/', // Canada
            '238'   => '/^[1-9][0-9]{7}$/', // Cape Verde
            '1345'  => '/^[1-9][0-9]{6,7}$/', // Cayman Islands
            '236'   => '/^[1-9][0-9]{8}$/', // Central African Republic
            '235'   => '/^[1-9][0-9]{8}$/', // Chad
            '56'    => '/^[1-9][0-9]{8}$/', // Chile
            '86'    => '/^[1-9][0-9]{10}$/', // China
            '57'    => '/^[1-9][0-9]{8}$/', // Colombia
            '269'   => '/^[1-9][0-9]{7}$/', // Comoros
            '242'   => '/^[1-9][0-9]{8}$/', // Congo
            '682'   => '/^[1-9][0-9]{5}$/', // Cook Islands
            '506'   => '/^[1-9][0-9]{7}$/', // Costa Rica
            '385'   => '/^[1-9][0-9]{8}$/', // Croatia
            '53'    => '/^[1-9][0-9]{6,7}$/', // Cuba
            '599'   => '/^[1-9][0-9]{7}$/', // Curaçao
            '357'   => '/^[1-9][0-9]{7}$/', // Cyprus
            '420'   => '/^[1-9][0-9]{8}$/', // Czechia
            '243'   => '/^[1-9][0-9]{8}$/', // DR Congo
            '45'    => '/^[1-9][0-9]{7}$/', // Denmark
            '253'   => '/^[1-9][0-9]{6,7}$/', // Djibouti
            '1767'  => '/^[1-9][0-9]{6,7}$/', // Dominica
            '1809'  => '/^[1-9][0-9]{9}$/', // Dominican Republic
            '593'   => '/^[1-9][0-9]{8}$/', // Ecuador
            '20'    => '/^[1-9][0-9]{8}$/', // Egypt
            '503'   => '/^[1-9][0-9]{7}$/', // El Salvador
            '240'   => '/^[1-9][0-9]{8}$/', // Equatorial Guinea
            '291'   => '/^[1-9][0-9]{6,7}$/', // Eritrea
            '372'   => '/^[5-7][0-9]{7,8}$/', // Estonia
            '268'   => '/^[1-9][0-9]{7}$/', // Eswatini
            '251'   => '/^[1-9][0-9]{8}$/', // Ethiopia
            '500'   => '/^[1-9][0-9]{5}$/', // Falkland Islands
            '298'   => '/^[1-9][0-9]{5,6}$/', // Faroe Islands
            '679'   => '/^[1-9][0-9]{6,7}$/', // Fiji
            '358'   => '/^[1-9][0-9]{7,8}$/', // Finland
            '33'    => '/^[1-9][0-9]{8}$/', // France
            '594'   => '/^[1-9][0-9]{8}$/', // French Guiana
            '689'   => '/^[1-9][0-9]{6}$/', // French Polynesia
            '241'   => '/^[1-9][0-9]{8}$/', // Gabon
            '220'   => '/^[1-9][0-9]{6,7}$/', // Gambia
            '995'   => '/^[1-9][0-9]{8}$/', // Georgia
            '49'    => '/^[1-9][0-9]{10}$/', // Germany
            '233'   => '/^[1-9][0-9]{8}$/', // Ghana
            '350'   => '/^[1-9][0-9]{7}$/', // Gibraltar
            '30'    => '/^[1-9][0-9]{9}$/', // Greece
            '299'   => '/^[1-9][0-9]{6}$/', // Greenland
            '1473'  => '/^[1-9][0-9]{6,7}$/', // Grenada
            '590'   => '/^[1-9][0-9]{8}$/', // Guadeloupe
            '1671'  => '/^[1-9][0-9]{6,7}$/', // Guam
            '502'   => '/^[1-9][0-9]{7}$/', // Guatemala
            '44'    => '/^[1-9][0-9]{9}$/', // Guernsey
            '224'   => '/^[1-9][0-9]{8}$/', // Guinea
            '245'   => '/^[1-9][0-9]{6,7}$/', // Guinea-Bissau
            '592'   => '/^[1-9][0-9]{6,7}$/', // Guyana
            '509'   => '/^[1-9][0-9]{7}$/', // Haiti
            '504'   => '/^[1-9][0-9]{7}$/', // Honduras
            '852'   => '/^[1-9][0-9]{7}$/', // Hong Kong
            '36'    => '/^[1-9][0-9]{8}$/', // Hungary
            '354'   => '/^[4-8][0-9]{6,7}$/', // Iceland
            '91'    => '/^[6-9][0-9]{9}$/', // India
            '62'    => '/^[1-9][0-9]{9,10}$/', // Indonesia
            '98'    => '/^[1-9][0-9]{9}$/', // Iran
            '964'   => '/^[1-9][0-9]{8}$/', // Iraq
            '353'   => '/^[1-9][0-9]{8}$/', // Ireland
            '44'    => '/^[1-9][0-9]{9}$/', // Isle of Man
            '972'   => '/^[1-9][0-9]{8,9}$/', // Israel
            '39'    => '/^[3-9][0-9]{9}$/', // Italy
            '1876'  => '/^[1-9][0-9]{6,7}$/', // Jamaica
            '81'    => '/^[1-9][0-9]{9}$/', // Japan
            '44'    => '/^[1-9][0-9]{9}$/', // Jersey
            '962'   => '/^[1-9][0-9]{8}$/', // Jordan
            '7'     => '/^[1-9][0-9]{9}$/', // Kazakhstan
            '254'   => '/^[1-9][0-9]{8}$/', // Kenya
            '686'   => '/^[1-9][0-9]{4,5}$/', // Kiribati
            '383'   => '/^[1-9][0-9]{8}$/', // Kosovo
            '965'   => '/^[1-9][0-9]{7}$/', // Kuwait
            '996'   => '/^[1-9][0-9]{8}$/', // Kyrgyzstan
            '856'   => '/^[1-9][0-9]{7,8}$/', // Laos
            '371'   => '/^[1-9][0-9]{7,8}$/', // Latvia
            '961'   => '/^[1-9][0-9]{7,8}$/', // Lebanon
            '266'   => '/^[1-9][0-9]{7}$/', // Lesotho
            '231'   => '/^[1-9][0-9]{7,8}$/', // Liberia
            '218'   => '/^[1-9][0-9]{8}$/', // Libya
            '423'   => '/^[1-9][0-9]{7,8}$/', // Liechtenstein
            '370'   => '/^[1-9][0-9]{7,8}$/', // Lithuania
            '352'   => '/^[1-9][0-9]{8}$/', // Luxembourg
            '853'   => '/^[1-9][0-9]{7}$/', // Macau
            '389'   => '/^[1-9][0-9]{7,8}$/', // North Macedonia
            '261'   => '/^[1-9][0-9]{7,8}$/', // Madagascar
            '265'   => '/^[1-9][0-9]{7,8}$/', // Malawi
            '60'    => '/^[1-9][0-9]{8,9}$/', // Malaysia
            '960'   => '/^[1-9][0-9]{6,7}$/', // Maldives
            '223'   => '/^[1-9][0-9]{7,8}$/', // Mali
            '356'   => '/^[1-9][0-9]{7}$/', // Malta
            '692'   => '/^[1-9][0-9]{6,7}$/', // Marshall Islands
            '596'   => '/^[1-9][0-9]{8}$/', // Martinique
            '222'   => '/^[1-9][0-9]{7,8}$/', // Mauritania
            '230'   => '/^[1-9][0-9]{7,8}$/', // Mauritius
            '52'    => '/^[1-9][0-9]{9}$/', // Mexico
            '691'   => '/^[1-9][0-9]{6,7}$/', // Micronesia
            '373'   => '/^[1-9][0-9]{7,8}$/', // Moldova
            '377'   => '/^[1-9][0-9]{8}$/', // Monaco
            '976'   => '/^[1-9][0-9]{7,8}$/', // Mongolia
            '382'   => '/^[1-9][0-9]{7,8}$/', // Montenegro
            '1664'  => '/^[1-9][0-9]{6,7}$/', // Montserrat
            '212'   => '/^[5-9][0-9]{8}$/', // Morocco
            '258'   => '/^[1-9][0-9]{8}$/', // Mozambique
            '95'    => '/^[1-9][0-9]{8,9}$/', // Myanmar
            '264'   => '/^[1-9][0-9]{7,8}$/', // Namibia
            '674'   => '/^[1-9][0-9]{4,5}$/', // Nauru
            '977'   => '/^[1-9][0-9]{9}$/', // Nepal
            '31'    => '/^[1-9][0-9]{8}$/', // Netherlands
            '687'   => '/^[1-9][0-9]{6}$/', // New Caledonia
            '64'    => '/^[2-9][0-9]{7,8}$/', // New Zealand
            '505'   => '/^[1-9][0-9]{7}$/', // Nicaragua
            '227'   => '/^[1-9][0-9]{7}$/', // Niger
            '234'   => '/^[1-9][0-9]{8}$/', // Nigeria
            '683'   => '/^[1-9][0-9]{4}$/', // Niue
            '1670'  => '/^[1-9][0-9]{6,7}$/', // Northern Mariana Islands
            '47'    => '/^[1-9][0-9]{7}$/', // Norway
            '968'   => '/^[1-9][0-9]{7}$/', // Oman
            '92'    => '/^[1-9][0-9]{9}$/', // Pakistan
            '680'   => '/^[1-9][0-9]{6,7}$/', // Palau
            '970'   => '/^[1-9][0-9]{8}$/', // Palestine
            '507'   => '/^[1-9][0-9]{7}$/', // Panama
            '675'   => '/^[1-9][0-9]{6,7}$/', // Papua New Guinea
            '595'   => '/^[1-9][0-9]{8,9}$/', // Paraguay
            '51'    => '/^9[0-9]{8}$/', // Peru
            '63'    => '/^[9][0-9]{9}$/', // Philippines
            '64'    => '/^[2-9][0-9]{7,8}$/', // Pitcairn Islands
            '48'    => '/^[5-8][0-9]{8}$/', // Poland
            '351'   => '/^[1-9][0-9]{8}$/', // Portugal
            '1787'  => '/^[1-9][0-9]{9}$/', // Puerto Rico
            '974'   => '/^[1-9][0-9]{7}$/', // Qatar
            '262'   => '/^[1-9][0-9]{8}$/', // Réunion
            '40'    => '/^[1-9][0-9]{8}$/', // Romania
            '7'     => '/^[1-9][0-9]{9}$/', // Russia
            '250'   => '/^[1-9][0-9]{8}$/', // Rwanda
            '290'   => '/^[1-9][0-9]{4}$/', // Saint Helena
            '1869'  => '/^[1-9][0-9]{6,7}$/', // Saint Kitts and Nevis
            '1758'  => '/^[1-9][0-9]{6,7}$/', // Saint Lucia
            '508'   => '/^[1-9][0-9]{6}$/', // Saint Pierre and Miquelon
            '1784'  => '/^[1-9][0-9]{6,7}$/', // Saint Vincent and the Grenadines
            '685'   => '/^[1-9][0-9]{5,6}$/', // Samoa
            '378'   => '/^[1-9][0-9]{7}$/', // San Marino
            '239'   => '/^[1-9][0-9]{6}$/', // São Tomé and Príncipe
            '966'   => '/^[1-9][0-9]{8}$/', // Saudi Arabia
            '221'   => '/^[7-9][0-9]{8}$/', // Senegal
            '381'   => '/^[1-9][0-9]{7,8}$/', // Serbia
            '248'   => '/^[1-9][0-9]{6,7}$/', // Seychelles
            '232'   => '/^[1-9][0-9]{7}$/', // Sierra Leone
            '65'    => '/^[1-9][0-9]{7}$/', // Singapore
            '1721'  => '/^[1-9][0-9]{6,7}$/', // Sint Maarten
            '421'   => '/^[1-9][0-9]{8}$/', // Slovakia
            '386'   => '/^[1-9][0-9]{8}$/', // Slovenia
            '677'   => '/^[1-9][0-9]{6}$/', // Solomon Islands
            '252'   => '/^[1-9][0-9]{7}$/', // Somalia
            '27'    => '/^[1-9][0-9]{8,9}$/', // South Africa
            '82'    => '/^[1-9][0-9]{8,9}$/', // South Korea
            '211'   => '/^[1-9][0-9]{8}$/', // South Sudan
            '34'    => '/^[1-9][0-9]{8}$/', // Spain
            '94'    => '/^[1-9][0-9]{8}$/', // Sri Lanka
            '249'   => '/^[1-9][0-9]{8}$/', // Sudan
            '597'   => '/^[1-9][0-9]{6,7}$/', // Suriname
            '47'    => '/^[1-9][0-9]{7}$/', // Svalbard and Jan Mayen
            '268'   => '/^[1-9][0-9]{7}$/', // Eswatini
            '46'    => '/^[1-9][0-9]{8}$/', // Sweden
            '41'    => '/^[1-9][0-9]{8}$/', // Switzerland
            '963'   => '/^[1-9][0-9]{8}$/', // Syria
            '886'   => '/^[1-9][0-9]{8}$/', // Taiwan
            '992'   => '/^[1-9][0-9]{8}$/', // Tajikistan
            '255'   => '/^[1-9][0-9]{8}$/', // Tanzania
            '66'    => '/^[1-9][0-9]{8}$/', // Thailand
            '670'   => '/^[1-9][0-9]{6,7}$/', // Timor-Leste
            '228'   => '/^[1-9][0-9]{8}$/', // Togo
            '690'   => '/^[1-9][0-9]{3,4}$/', // Tokelau
            '676'   => '/^[1-9][0-9]{4,5}$/', // Tonga
            '1868'  => '/^[1-9][0-9]{6,7}$/', // Trinidad and Tobago
            '216'   => '/^[1-9][0-9]{8}$/', // Tunisia
            '90'    => '/^[1-9][0-9]{9}$/', // Turkey
            '993'   => '/^[1-9][0-9]{8}$/', // Turkmenistan
            '1649'  => '/^[1-9][0-9]{6,7}$/', // Turks and Caicos Islands
            '688'   => '/^[1-9][0-9]{4,5}$/', // Tuvalu
            '256'   => '/^[1-9][0-9]{8}$/', // Uganda
            '380'   => '/^[1-9][0-9]{8}$/', // Ukraine
            '971'   => '/^[1-9][0-9]{8}$/', // United Arab Emirates
            '44'    => '/^[1-9][0-9]{9}$/', // United Kingdom
            '1'     => '/^[2-9][0-9]{9}$/', // United States
            '598'   => '/^[2-9][0-9]{7,8}$/', // Uruguay
            '998'   => '/^[1-9][0-9]{8}$/', // Uzbekistan
            '678'   => '/^[1-9][0-9]{6,7}$/', // Vanuatu
            '379'   => '/^[1-9][0-9]{6,7}$/', // Vatican City
            '58'    => '/^[1-9][0-9]{9}$/', // Venezuela
            '84'    => '/^[1-9][0-9]{9}$/', // Vietnam
            '681'   => '/^[1-9][0-9]{5}$/', // Wallis and Futuna
            '967'   => '/^[1-9][0-9]{8}$/', // Yemen
            '260'   => '/^[1-9][0-9]{8}$/', // Zambia
            '263'   => '/^[1-9][0-9]{8}$/', // Zimbabwe
        ];


        // Eliminar cualquier signo de más al principio del número de teléfono
        $value = ltrim($value, '+');

        // Verificar si existe un patrón para el código de país proporcionado
        if (isset($patterns[$this->countryCode])) {
            if (!preg_match($patterns[$this->countryCode], $value)) {
                $fail('El número de teléfono no es válido para el país seleccionado.');
            }
        } else {
            $fail('El código de país no es válido.');
        }
    }
}
